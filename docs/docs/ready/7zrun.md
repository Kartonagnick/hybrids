[![logo](../../logo.png)](../../docs.md "documentation") 

[M]: ../../docs.md        "родитель"
[P]: ../../icons/progress.png  "в процессе..."
[S]: ../../icons/success.png   "ошибок не обнаружено"
[E]: ../../icons/empty.png     "нет данных"

[![S]][M] 7zrun v0.0.1
======================
Гибрид предназначен для удобного формирования опций запуска 7z.exe  
Позволяет:
  - удобным образом задавать маски игнорируемых файлов или каталогов  
  - задавать макс. размер файла, который подлежит архивированию  
  - задавать макс. размер каталога, который подлежит архивированию  
  - указывать стиль файлового пути для итогового архива (или архивов)  
  - позволяет работать со стешами проектов workspace  
<br/>


TYPICAL or CLASSIC
------------------
Допустим, нужно запаковать каталог со следующим содержимым:  
```
example
  |--- file.hpp
   `-- file.cpp
```


В типичном случае в корне архива запишется упакованный каталог.  
Данный режим используется по умолчанию:  
```
example.7z
  `-- example
        |--- file.hpp     
         `-- file.cpp
```

А в классическом стиле, в корне архива записывается содержимое каталога,  
но сам каталог уже не указывается:  
```
example.7z
  |--- file.hpp     
   `-- file.cpp
```


SINGLE or MULTI
---------------
Режим `SINGLE` означает, что нужно запаковать весь `eDIR_SRC`, как один большой архив.  
Данный режим используется по умолчанию.  

Режим `MULTI` означает, что нужно запаковать отдельно все подкаталоги в корне `eDIR_SRC`,  
получив таким образом множество подкаталогов.  
Что бы активировать режим `MULTI` нужно задать соответствующий стиль выходного каталога:  
  - в переменной `eSTYLE` нужно указать ключевое слово `dir`,  
    например: `set eSTYLE=name-date/dir-ver-tag`  
<br/>


STYLE
-----
Стиль задается в переменной `eSTYLE`, и определяет файловые пути для размещения итоговых архивов.  
Ключевые слова:  
  - `name` раскрывается в имя `eDIR_SRC`  
  - `date` раскроется в временныую метку в формате: [Y-Mm-D][Hh-Mm] 
    - например: [2024-12m-18][06h-27m]
  - `ver` раскроется в версию проекта без точек:  
    - например: если версия `0.0.1`, тогда ver будет равен `001`  
  - `pre` раскроется тэг версии проекта:  
    - например: `PRE` или `REL` или `BUG`  
  - `dir` раскроектся в имя `eDIR_SRC/dir`  
    - и при этом активирует режим `MULTI`
<br/>


Временная метка
---------------
Задается при помощи ключевого слова `date` в строке `style`  
По умолчанию имеет вид:  
  - format : `[YY-MMm-DD][hhh-mmm]`  
  - example: `[2024-12m-18][06h-27m]`  

Например, пусть `style` имеет значение `name-date`, и при этом:  
  - архивируется проект: `C://example`  
  - текущее время: `2024-12m-20 16:20`  

Тогда, итоговый файловый путь получится: `example-[2024-12m-20][16h-20m]`  
<br/>


Версия архива
-------------
Актуально для проектов workspace  
Они имеют в своем составе файл `docs/history.md`  
В котором зашифрованна версия проекта.  
Актуальная версия указана в самой первой записи файла вида:  

```
[![S]][H] **v0.5.8 (dev)**
```

Из этой строки извлекаются фрагменты: `![S]` и `v0.5.8`  
Первый фрагмент отвечает за тэг версии, и может принимать значения:  
  - `![S]` - означает `success`, т.е., уже спешно выполненная задача.  
    Тэг версии: `REL`  
  - `![P]` - означает `progress`, т.е., задача ещё в процессе выполнения.  
    Тэг версии: `PRE`  
  - `![B]` - означает `bug`, задача, в реализации которой был обнаружен баг.  
    Тэг версии: `BUG`  

Второй фрагмент: `v0.5.8` содержит непосредственно номер версии.  
Из номера версии удаляется буква `v` и символы точек `.`  

Таким образом, в данном случае получается:  
  - `ver: 058`  
  - `pre: REL`  

Далее, гибрид использует полученные значения при формировании итогого файлогового пути.  
Например, пусть `style` имет значение `name-ver-tag`, а проект называется `hybrids`.  
Тогда стиль примет вид: `hybrids-058-REL`
<br/>


STASH or NOSTASH
----------------
Гибрид поддерживает два режима:  
 - `STASH` - режим для архивирования проектов workspace  
 - `NOSTASH` - режим "без стеша"  

По умолчанию используется режим `STASH`  

Режим `STASH` специально создан для работы с проектами workspace  
Идея заключается в том, что бы архивировать проект, находясь в каталоге его стеша.  
Например, мы находимся в каталоге: `D:\local\_stash\hybrids`  
И запускаем: `[vbs]-backup.bat`  

По имени каталога `D:\local\_stash\hybrids`, скрипт пониманиет, что имя проекта - `hybrids`  
Далее, скрипт пытается обнаружить проект `hybrids` двумя этажами выше.  

Если каталог `D:\local\hybrids` существует, значит именно его и нужно заархивировать.  
А если такого каталога не существует, значит заархивировать нужно `D:\local\_stash\hybrids`  
Таким образом, режимы `STASH|NOSTASH` влияют на автоматическое определение значения `eDIR_SRC`  
<br/>


Пример использования
--------------------
Открывает файл `7zrun.bat` в любом редакторе, и смотрим на управляющие параметры:  

```bat
::'set "xDEBUG=ON"
::'set "xDIR_7Z=C:\Program Files\7-Zip"   
::'set "xDIR_WORK=%~dp0."
::'set "xDIR_SRC=C:\example"  
::'set "xDIR_DST=C:\backup"  
::'set "xNAME7Z=example"   
::'set "eSTYLE=root-ver\date-pre    
::'set "xPASSWORD=**"
::'set "xTIMESPAMP=[2024-12m-22][07h-51m]"
::'set "eEXCLUDE=msvc-temporary;_backup"  
::'set "xCLASSIC=ON"  
::'set "xNOSTASH=OFF"  
```

Если нужно активировать параметр, нужно заменить имя `xPARAM` на `ePARAM`.  
Далее, указываем нужные значения параметров.  
После чего просто запускаем батник на выполнение.  
<br/>


Управляющие параметры
---------------------

| переменная | назначение                        |                     по умолчанию                     |
|:----------:|:---------------------------------:|:----------------------------------------------------:|
| eDIR_7Z    | определяет путь к каталогу 7z.exe | C:\Program Files\7-Zip; C:\Program Files (x86)\7-Zip |
| eDIR_WORK  | рабочий каталог                   | текущий каталог операционной системы                 |
| eDIR_SRC   | каталог, который нужно запаковать | по особым правилам: eDIR_WORK или поиск проекта      |
| eDIR_DST   | каталог результирующих архивов    | eDIR_WORK/_backup                                    |
| eNAME7Z    | имя архивируемого каталога        | имя каталога eDIR_SRC                                |
| eSTYLE     | стиль выходных путей архивов      | пустой                                               |
| ePASSWORD  | пароль на архив                   | пароль отсутствует                                   |
| eTIMESPAMP | временная метка                   | используется текущая дата и время                    |
| eEXCLUDE   | маски игнорируемых файлов/папок   | пустой                                               |
| eCLASSIC   | вкл классический режим            | выкл. по умолчанию действует typical mode            |
| eNOSTASH   | вкл режим "без стеша"             | выкл                                                 |

<br/>

Управляющие параметры вывода данных в консоль
---------------------------------------------
определяются в файлк: `echo.vbs`  

| переменная |        назначение         | по умолчанию |
|:----------:|:-------------------------:|:------------:|
| eDEBUG     | вкл/выкл отладочный вывод |     выкл     |
| eSILENCE   | подавляет вывод echo/dbg  |     выкл     |
| eINDENT    | задает грубину отступа    |      0       |

<br/>

--------------------------------------------------------------------------------

История изменений 
-----------------

| **ID** |      версия     |    дата    | время |      ветка      | status  | продукт |  
|:------:|:---------------:|:----------:|:-----:|:---------------:|:-------:|:-------:|  
|  0003  | 0.0.1 [![S]][M] | 2024-12-08 | 19:00 | [#59-dev-7zrun] | VERSION |  0.0.1  |  
|  0002  | 0.0.1 [![S]][M] | 2024-12-08 | 18:50 | [#59-dev-7zrun] |  DONE   |  0.0.1  |  
|  0001  | 0.0.1 [![E]][M] | 2024-12-08 | 05:30 | [#59-dev-7zrun] |  BEGIN  |  0.0.1  |  

*ПРИМЕЧАНИЕ:* под продуктом подразумевается версия `ready/7zrun.bat`  

[#59-dev-7zrun]: ../../history.md#-v059-dev
